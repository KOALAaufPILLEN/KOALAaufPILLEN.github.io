:root {
  /* --- Default (Candy Light) --- */
  --bg1: #f7f2ff;
  --bg2: #eaf6ff;
  --card: rgba(255, 255, 255, 0.85);
  --card2: rgba(255, 255, 255, 0.94);
  --text: #1d1334;
  --stroke: rgba(17, 13, 26, 0.10);
  --shadow: 0 18px 60px rgba(20, 10, 60, 0.12);
  --accent: #975fff;
  --accent-glow: rgba(151, 95, 255, 0.3);
  --bar-bg: rgba(140, 120, 200, 0.18);
  
  /* Board Colors */
  --board-bg-grad: radial-gradient(circle at 20% 20%, rgba(255,255,255,.86), rgba(255,255,255,.35));
  --board-swirl: rgba(255,255,255,.18);
  
  /* Grid Params */
  --cols: 10;
  --rows: 10;
  --cell: 54px;
  --gap: 8px;
  --pad: 14px;
  --boardRadius: 26px;
  --toastMs: 2600ms;
}

/* --- Dark Mode Override --- */
body.dark-mode {
  --bg1: #0f0518;
  --bg2: #1a0b2e;
  --card: rgba(30, 20, 50, 0.65); /* Glass dark */
  --card2: rgba(40, 25, 60, 0.75);
  --text: #e0d0ff;
  --stroke: rgba(255, 255, 255, 0.12);
  --shadow: 0 20px 60px rgba(0, 0, 0, 0.6);
  --accent: #d88aff;
  --accent-glow: rgba(216, 138, 255, 0.4);
  --bar-bg: rgba(255, 255, 255, 0.1);
  
  --board-bg-grad: radial-gradient(circle at 50% 50%, rgba(50, 20, 80, 0.5), rgba(0,0,0,0.8));
  --board-swirl: rgba(255,0,255,0.1);
}

/* Base Reset & Typography */
* { box-sizing: border-box; }
html, body { height: 100%; }
body {
  margin: 0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  color: var(--text);
  overflow: hidden;
  background: linear-gradient(180deg, var(--bg1), var(--bg2));
  position: relative;
  transition: background 0.5s ease, color 0.5s ease;
}

/* Scroll Container */
#page {
  height: 100vh; overflow: auto; position: relative; z-index: 0;
  scrollbar-width: none;
}
#page::-webkit-scrollbar { width: 0; height: 0; }

/* Dynamic Backgrounds (Original preserved) */
#scrollBg {
  position: absolute; inset: 0; z-index: 0; pointer-events: none; min-height: 120vh;
  background: radial-gradient(circle at 20% 20%, rgba(255,105,180,.14), transparent 48%),
              radial-gradient(circle at 85% 25%, rgba(122,216,255,.20), transparent 52%),
              radial-gradient(circle at 55% 75%, rgba(255,209,90,.16), transparent 50%);
  filter: blur(18px); opacity: .55;
  animation: bgMove 18s ease-in-out infinite;
}
body.dark-mode #scrollBg {
  background: radial-gradient(circle at 20% 20%, rgba(157,0,255,.15), transparent 48%),
              radial-gradient(circle at 85% 25%, rgba(0,255,255,.10), transparent 52%);
  opacity: 0.8;
}

@keyframes bgMove {
  0% { background-position: 0% 50% }
  50% { background-position: 100% 50% }
  100% { background-position: 0% 50% }
}

#globalBg { position: absolute; inset: 0; z-index: 0; pointer-events: none; overflow: hidden; }

/* Luvvies Background Floaters */
.bgLuv {
  position: absolute; width: clamp(150px, 17vw, 300px);
  filter: drop-shadow(0 18px 40px rgba(0,0,0,.10));
  opacity: .72;
  animation: floaty 18s ease-in-out infinite;
  z-index: 0; pointer-events: none;
}
.bgLuv img { width: 100%; height: auto; display: block; }
@keyframes floaty {
  0% { transform: translate(0,0) rotate(-1deg); opacity: .64; }
  50% { transform: translate(10px,-16px) rotate(1.2deg); opacity: .82; }
  100% { transform: translate(0,0) rotate(-1deg); opacity: .64; }
}

/* Layout */
#app {
  width: min(1100px, 96vw);
  margin: 18px auto 28px;
  position: relative; z-index: 5;
}

/* Cards & Panels */
.topRow, .stats, .progressRow, .panel, .playArea {
  background: var(--card);
  border: 1px solid var(--stroke);
  border-radius: 22px;
  box-shadow: var(--shadow);
  backdrop-filter: blur(12px);
  transition: background 0.3s;
}

.topRow {
  padding: 12px; display: flex; align-items: center; justify-content: space-between; gap: 12px; flex-wrap: wrap; margin-top: 12px;
}

/* Difficulty Pills */
.diffWrap { display: flex; align-items: center; gap: 10px; flex-wrap: wrap; }
.diffWrap .label { font-weight: 900; opacity: .9; }
.diffPills {
  display: flex; gap: 8px; padding: 6px; border-radius: 999px;
  background: rgba(255,255,255,.3); border: 1px solid var(--stroke);
}
.diffPills input { display: none; }
.diffPills label {
  cursor: pointer; padding: 10px 14px; border-radius: 999px;
  font-weight: 900; font-size: 14px; color: var(--text); opacity: 0.7;
  transition: all 0.2s ease;
}
.diffPills input:checked + label {
  background: linear-gradient(135deg, #ff4fb9, #7ad8ff);
  color: #fff; opacity: 1;
  box-shadow: 0 5px 15px rgba(255,79,185,.3);
  transform: translateY(-1px);
}

/* Jelly Buttons (Preserved!) */
.Btn {
  position: relative; height: 46px; padding: 0 16px; border-radius: 999px; border: none;
  background-color: var(--accent); color: white;
  box-shadow: 0px 5px 10px rgba(0,0,0,0.2) inset, 0px 5px 10px rgba(0,0,0,0.1);
  cursor: pointer; display: inline-flex; align-items: center; justify-content: center; gap: 8px;
  font-weight: 1000; letter-spacing: .1px; transition: transform .12s ease;
}
.Btn:hover { animation: jello-horizontal 0.9s both; }
.Btn:active { transform: scale(.98); }
.Btn.secondary { background: linear-gradient(135deg, #ff4fb9, #ff9adf); }
.Btn.ghost { background: rgba(255,255,255,0.2); color: var(--text); border: 1px solid var(--stroke); }

@keyframes jello-horizontal {
  0% { transform: scale3d(1, 1, 1); }
  30% { transform: scale3d(1.20, 0.80, 1); }
  40% { transform: scale3d(0.80, 1.20, 1); }
  50% { transform: scale3d(1.12, 0.88, 1); }
  65% { transform: scale3d(0.96, 1.04, 1); }
  100% { transform: scale3d(1, 1, 1); }
}

/* Stats */
.stats {
  margin-top: 12px; display: grid; grid-template-columns: repeat(5, minmax(0, 1fr)); gap: 10px; padding: 10px;
}
.stat {
  background: var(--card2); border: 1px solid var(--stroke); border-radius: 18px;
  padding: 10px; display: flex; flex-direction: column; justify-content: center;
}
.stat .k { font-size: 11px; font-weight: 900; opacity: 0.6; text-transform: uppercase; }
.stat .v { font-size: 20px; font-weight: 1000; }
.stat .v.big { font-size: 24px; color: #ff4fb9; }
body.dark-mode .stat .v.big { color: #d88aff; text-shadow: 0 0 10px rgba(216, 138, 255, 0.6); }

/* Progress Bar */
.progressRow {
  margin-top: 10px; padding: 12px; display: flex; align-items: center; gap: 10px;
}
.bar {
  flex: 1; height: 14px; border-radius: 999px; background: var(--bar-bg); overflow: hidden; border: 1px solid var(--stroke);
}
.bar > i {
  display: block; height: 100%; width: 0%; border-radius: 999px;
  background: linear-gradient(90deg, #ff4fb9, #ffcf5a, #7ad8ff, #8b5cf6, #ff4fb9);
  background-size: 300% 100%; animation: barHue 3.2s linear infinite;
  box-shadow: 0 0 15px rgba(255,79,185,.4);
}
@keyframes barHue { 0%{background-position:0% 50%} 100%{background-position:100% 50%} }

/* Game Board */
.playArea { margin-top: 12px; padding: 14px; overflow: hidden; }
#boardWrap {
  width: 100%; min-height: 64vh; display: flex; align-items: center; justify-content: center;
  position: relative; z-index: 10;
}
#board {
  position: relative; z-index: 12; padding: var(--pad);
  border-radius: var(--boardRadius);
  background: var(--board-bg-grad);
  border: 1px solid var(--stroke);
  box-shadow: 0 18px 70px rgba(0,0,0,0.15), inset 0 0 40px rgba(255,255,255,0.1);
  overflow: hidden;
}
/* Board Swirl Effect */
#board:before {
  content:""; position: absolute; inset: -20px;
  background: conic-gradient(from 180deg at 35% 35%, var(--board-swirl), transparent 45%, var(--board-swirl));
  opacity: .45; mix-blend-mode: soft-light; pointer-events: none;
}

/* Tiles */
.tile {
  position: absolute; width: var(--cell); height: var(--cell);
  transform: translate(var(--x), var(--y));
  transition: transform 190ms cubic-bezier(.2,.9,.2,1.0);
  will-change: transform; z-index: 15; cursor: pointer;
}
.tile.bigMellow, .tile.bossZilla {
  z-index: 25;
}
.tile.bossZilla {
  width: calc(var(--cell) * 3 + var(--gap) * 2);
  height: calc(var(--cell) * 3 + var(--gap) * 2);
  animation: bossWiggle 3s ease-in-out infinite;
}
@keyframes bossWiggle {
  0%, 100% { transform: translate(var(--x), var(--y)) rotate(0deg) scale(1); }
  25% { transform: translate(var(--x), var(--y)) rotate(2deg) scale(1.02); }
  75% { transform: translate(var(--x), var(--y)) rotate(-2deg) scale(1.02); }
}

.plate {
  width: 100%; height: 100%; border-radius: 16px;
  background: radial-gradient(circle at 22% 18%, rgba(255,255,255,.8), transparent 40%),
              linear-gradient(135deg, var(--p1), var(--p2));
  border: 1px solid rgba(255,255,255,0.5);
  box-shadow: 0 8px 16px rgba(0,0,0,0.15), inset 0 -4px 8px rgba(0,0,0,0.1);
  position: relative; overflow: hidden;
}
/* Neon Glow in Dark Mode */
body.dark-mode .plate {
  box-shadow: 0 0 10px var(--p1), inset 0 0 5px rgba(255,255,255,0.3);
  border: 1px solid rgba(255,255,255,0.2);
}

.tile img {
  position: absolute; inset: 6%; width: 88%; height: 88%; object-fit: contain;
  filter: drop-shadow(0 5px 8px rgba(0,0,0,0.2));
  pointer-events: none;
}

/* FX: Pop, Land, Spawn (Preserved) */
.pop .plate { animation: popPlate 420ms ease-in both; }
@keyframes popPlate {
  0% { transform: scale(1); opacity:1; }
  100% { transform: scale(.3); opacity:0; }
}

/* HP Indicator */
.hp {
  position: absolute; right: 4px; top: 4px;
  font-weight: 1000; font-size: 16px; color: #fff;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
  z-index: 30; pointer-events: none;
}

/* Badge for Hint Cost */
.badge {
  background: rgba(0,0,0,0.2); border-radius: 4px; padding: 2px 6px; font-size: 10px; margin-left: 6px;
}

/* Toggle Switch */
.theme-switch-wrapper { display: flex; align-items: center; justify-content: center; margin: 10px 0; gap: 10px; }
.theme-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
.theme-switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; inset: 0; background-color: #ccc; transition: .4s; border-radius: 34px; }
.slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: #975fff; }
input:checked + .slider:before { transform: translateX(24px); }

/* Leaderboard & Menu */
.below { margin-top: 12px; display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
@media (max-width: 800px) { .below { grid-template-columns: 1fr; } }

.luvCard {
  display: flex; gap: 10px; align-items: center; padding: 10px;
  border-radius: 18px; background: rgba(255,255,255,0.5);
  border: 1px solid var(--stroke); cursor: pointer; transition: transform .1s;
}
.luvCard:hover { transform: translateY(-2px); }
.luvCard img { width: 60px; height: 60px; object-fit: contain; }

.lbList { max-height: 250px; overflow-y: auto; display: flex; flex-direction: column; gap: 8px; margin-top: 10px; }
.lbItem {
  display: flex; justify-content: space-between; padding: 8px 12px;
  background: rgba(255,255,255,0.4); border-radius: 12px; font-size: 14px;
}
.lbItem.rank1 { background: linear-gradient(90deg, rgba(255,215,0,.3), transparent); border: 1px solid gold; }

/* Modals */
.modalBack {
  position: fixed; inset: 0; background: rgba(0,0,0,0.6); backdrop-filter: blur(4px);
  display: none; align-items: center; justify-content: center; z-index: 9999;
}
.modal {
  width: min(600px, 90vw); background: var(--card2); padding: 20px;
  border-radius: 24px; border: 1px solid var(--stroke);
  box-shadow: 0 20px 50px rgba(0,0,0,0.3); max-height: 85vh; overflow-y: auto;
}
.info-img-preview { width: 120px; height: 120px; object-fit: contain; }
